<!DOCTYPE html>
<html lang="es">
<script>
  // ==============================
  // SISTEMA DE CONFIRMACIONES
  // ==============================

  let isLoggedIn = false;
  const ADMIN_PASSWORD = 'margarita2025';
  let guestsData = [];

  // Cargar datos del almacenamiento local
  function loadFromLocalStorage() {
    try {
      const stored = localStorage.getItem('wedding_guests');
      guestsData = stored ? JSON.parse(stored) : [];
    } catch (e) {
      console.error('Error al cargar:', e);
      guestsData = [];
    }
  }

  function saveToLocalStorage() {
    try {
      localStorage.setItem('wedding_guests', JSON.stringify(guestsData));
    } catch (e) {
      console.error('Error al guardar:', e);
    }
  }

  function toggleAdminSection() {
    const section = document.getElementById('adminSection');
    section.style.display =
      section.style.display === 'block' ? 'none' : 'block';
    if (section.style.display === 'block') section.scrollIntoView({ behavior: 'smooth' });
  }

  function checkPassword() {
    const password = document.getElementById('adminPassword').value;
    const errorMsg = document.getElementById('loginError');

    if (password === ADMIN_PASSWORD) {
      isLoggedIn = true;
      document.getElementById('adminLogin').style.display = 'none';
      document.getElementById('adminContent').style.display = 'block';
      errorMsg.style.display = 'none';
      loadGuests();
    } else {
      errorMsg.style.display = 'block';
      document.getElementById('adminPassword').value = '';
    }
  }

  function logout() {
    isLoggedIn = false;
    document.getElementById('adminLogin').style.display = 'block';
    document.getElementById('adminContent').style.display = 'none';
    document.getElementById('adminSection').style.display = 'none';
  }

  // Mostrar lista de confirmados
  function loadGuests() {
    if (!isLoggedIn) return;

    const guestList = document.getElementById('guestList');
    if (!guestsData || guestsData.length === 0) {
      guestList.innerHTML =
        '<p style="text-align:center;color:#999;">A√∫n no hay confirmaciones.</p>';
      return;
    }

    let totalPersonas = 0;
    let html = `
      <div style="margin-bottom:1rem;text-align:center;font-size:1.2rem;color:var(--vino);">
        <strong>üìã Confirmaciones: ${guestsData.length}</strong>
      </div>
    `;

    guestsData.forEach((g, i) => {
      totalPersonas += 1 + (g.acompanantes || 0);
      html += `
        <div style="border-bottom:1px solid #f0f0f0;padding:1rem 0;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;">
          <div style="flex:1;min-width:200px;">
            <strong style="color:var(--vino);">${g.nombre}</strong><br>
            <small style="color:#999;">${g.correo}</small><br>
            <small>üë• ${g.acompanantes || 0} acompa√±ante(s) | üìÖ ${new Date(g.fecha).toLocaleDateString('es-ES')}</small>
          </div>
          <button onclick="deleteGuest(${i})" style="background:#dc3545;color:white;border:none;padding:0.5rem 1rem;border-radius:5px;cursor:pointer;">Eliminar</button>
        </div>
      `;
    });

    html =
      `<div style="margin-bottom:1.5rem;text-align:center;font-size:1.3rem;color:var(--vino);background:var(--beige);padding:1rem;border-radius:10px;">
        <strong>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Total de personas: ${totalPersonas}</strong>
      </div>` + html;

    guestList.innerHTML = html;
  }

  function deleteGuest(index) {
    if (!isLoggedIn) return;
    if (!confirm('¬øEliminar esta confirmaci√≥n?')) return;
    guestsData.splice(index, 1);
    saveToLocalStorage();
    loadGuests();
  }

  function clearAllGuests() {
    if (!isLoggedIn) return;
    if (!confirm('¬øEliminar TODAS las confirmaciones?')) return;
    guestsData = [];
    saveToLocalStorage();
    loadGuests();
  }

  function exportGuests() {
    if (!isLoggedIn) return;
    if (guestsData.length === 0) {
      alert('No hay confirmaciones para exportar.');
      return;
    }

    let csv = 'Nombre,Correo,Acompa√±antes,Fecha de Confirmaci√≥n\n';
    guestsData.forEach((g) => {
      csv += `"${g.nombre}","${g.correo}",${g.acompanantes || 0},"${new Date(
        g.fecha
      ).toLocaleDateString('es-ES')}"\n`;
    });

    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'confirmaciones_boda_margarita_harold.csv';
    a.click();
  }

  // Formulario de confirmaci√≥n
  document.addEventListener('DOMContentLoaded', () => {
    loadFromLocalStorage();

    document
      .getElementById('rsvpForm')
      .addEventListener('submit', (e) => {
        e.preventDefault();
        const nombre = document.getElementById('nombre').value.trim();
        const correo = document.getElementById('correo').value.trim();
        const acompanantes =
          parseInt(document.getElementById('acompanantes').value) || 0;

        if (!nombre || !correo) {
          alert('Por favor completa todos los campos.');
          return;
        }

        const guest = {
          nombre,
          correo,
          acompanantes,
          fecha: new Date().toISOString(),
        };

        guestsData.push(guest);
        saveToLocalStorage();

        document.getElementById('rsvpForm').reset();
        document.getElementById('successMessage').style.display = 'block';
        setTimeout(
          () =>
            (document.getElementById('successMessage').style.display = 'none'),
          4000
        );

        if (isLoggedIn) loadGuests();
      });
  });
</script>
 
  </script>
</body>
</html>
